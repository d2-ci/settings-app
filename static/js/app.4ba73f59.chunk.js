(this["webpackJsonp@dhis2/app-shell"]=this["webpackJsonp@dhis2/app-shell"]||[]).push([[135],{1183:function(e){e.exports=JSON.parse('{"Failed to load: {{error}}":"","No flag":"","Search settings":"","Cancel upload":"","Replace image":"","Preview image":"","Upload image":"","Select language":"","OAuth2 client saved":"","Failed to save OAuth2 client":"","This client ID is already taken":"","Name":"","Required":"","Client ID":"","Client Secret":"","Grant Types":"","Password":"","Refresh token":"","Authorization code":"","One URL per line":"","Redirect URIs":"","This field should contain a list of URLs":"","Create new OAuth2 Client":"","Edit OAuth2 Client":"","Save":"","Delete":"","Cancel":"","Edit":"","There are currently no OAuth2 clients registered":"","General settings":"","Search results":"","analytics_settings":""}')},1185:function(e,t,a){"use strict";a.r(t);var s=a(7),n=a(1184),i=a(6),o=a(1),r=a.n(o),l=a(5),c=a(538),p=a(620),d=a.n(p),h=a(627),u=a.n(h),m=a(633),y=a.n(m),g=a(3),_=a.n(g),b=a(669),v=a.n(b),S=a(318),k=S.a.create(),T=a(336),f=a(514),E=a(273);const A=["general","server","appearance","email","access","calendar","import","sync","monitoring","oauth2"],C={general:{label:"general",icon:"settings",pageLabel:l.a.t("General settings"),settings:["keyAnalyticsMaxLimit","keySqlViewMaxLimit","infrastructuralIndicators","infrastructuralDataElements","infrastructuralPeriodType","keyAnalysisRelativePeriod","feedbackRecipients","offlineOrganisationUnitLevel","factorDeviation","phoneNumberAreaCode","multiOrganisationUnitForms","keyAcceptanceRequiredForApproval","keyGatherAnalyticalObjectStatisticsInDashboardViews","keyCountPassiveDashboardViewsInUsageAnalytics"]},analytics:{label:"analytics",icon:"equalizer",pageLabel:l.a.t("analytics_settings"),settings:["keyAnalysisRelativePeriod","keyHideDailyPeriods","keyHideWeeklyPeriods","keyHideMonthlyPeriods","keyHideBiMonthlyPeriods","analyticsFinancialYearStart","keyCacheStrategy","keyCacheability","keyAnalyticsCacheTtlMode","keyAnalyticsCacheProgressiveTtlFactor","keyIgnoreAnalyticsApprovalYearThreshold","keyRespectMetaDataStartEndDatesInAnalyticsTableExport","keyAnalyticsMaintenanceMode"]},server:{label:"server",icon:"business",pageLabel:"server_settings",settings:["keyDatabaseServerCpus","keySystemNotificationsEmail","googleAnalyticsUA","keyGoogleMapsApiKey","keyBingMapsApiKey"]},appearance:{label:"appearance",icon:"looks",pageLabel:"appearance_settings",settings:["localizedText","keyStyle","startModule","helpPageLink","keyFlag","keyUiLocale","keyDbLocale","keyAnalysisDisplayProperty","keyAnalysisDigitGroupSeparator","keyRequireAddToView","keyUseCustomLogoFront","keyUseCustomLogoBanner","keyDashboardContextMenuItemSwitchViewType","keyDashboardContextMenuItemOpenInRelevantApp","keyDashboardContextMenuItemShowInterpretationsAndDetails","keyDashboardContextMenuItemViewFullscreen"]},email:{label:"email",icon:"email",pageLabel:"email_settings",settings:["keyEmailHostName","keyEmailPort","keyEmailUsername","keyEmailPassword","keyEmailTls","keyEmailSender","emailTestButton"]},access:{label:"access",icon:"lock_open",pageLabel:"access_settings",settings:["selfRegistrationRole","selfRegistrationOrgUnit","keySelfRegistrationNoRecaptcha","keyAccountRecovery","keyLockMultipleFailedLogins","keyCanGrantOwnUserAuthorityGroups","keyAllowObjectAssignment","credentialsExpires","credentialsExpiryAlert","minPasswordLength","corsWhitelist","recaptchaSite","recaptchaSecret"]},calendar:{label:"calendar",icon:"date_range",pageLabel:"calendar_settings",settings:["keyCalendar","keyDateFormat"]},import:{label:"import",icon:"system_update_alt",pageLabel:"import_settings",settings:["keyDataImportStrictPeriods","keyDataImportStrictDataElements","keyDataImportStrictCategoryOptionCombos","keyDataImportStrictOrganisationUnits","keyDataImportStrictAttributeOptionCombos","keyDataImportRequireCategoryOptionCombo","keyDataImportRequireAttributeOptionCombo"]},sync:{label:"synchronization",icon:"sync",pageLabel:"synchronization_settings",settings:["keyRemoteInstanceUrl","keyRemoteInstanceUsername","keyRemoteInstancePassword","keyMetadataDataVersioning"]},oauth2:{label:"oauth2_clients",icon:"vpn_lock",pageLabel:"oauth2_clients",authority:"F_OAUTH2_CLIENT_MANAGE",settings:["oauth2clients"]}};var w={keyAnalyticsMaxLimit:{label:"analytics_max_limit",type:"dropdown",options:{5e4:5e4,1e5:1e5,2e5:2e5,0:"unlimited"}},keySqlViewMaxLimit:{label:"sql_view_max_limit",type:"dropdown",options:{"-1":"sql_view_max_limit_unlimited",5e4:"sql_view_max_limit_50000",1e5:"sql_view_max_limit_100000",2e5:"sql_view_max_limit_200000"}},infrastructuralIndicators:{label:"infrastructural_indicators",configuration:!0,type:"dropdown",source:"indicatorGroups"},infrastructuralDataElements:{label:"infrastructural_data_elements",configuration:!0,type:"dropdown",source:"dataElementGroups"},infrastructuralPeriodType:{label:"infrastructural_period_type",configuration:!0,type:"dropdown",options:{Daily:"Daily",Weekly:"Weekly",Monthly:"Monthly",BiMonthly:"BiMonthly",Quarterly:"Quarterly",SixMonthly:"SixMonthly",SixMonthlyApril:"SixMonthlyApril",Yearly:"yearly",FinancialApril:"FinancialApril",FinancialJuly:"FinancialJuly",FinancialOct:"FinancialOct"}},feedbackRecipients:{label:"feedback_recipients",configuration:!0,type:"dropdown",source:"userGroups",includeEmpty:!0,emptyLabel:"no_feedback_recipients"},offlineOrganisationUnitLevel:{label:"max_levels_to_offline",description:"relative_to_current_user",configuration:!0,type:"dropdown",source:"organisationUnitLevels"},factorDeviation:{label:"data_analysis_factor",validators:["positive_number"]},phoneNumberAreaCode:{label:"phone_number_area_code",validators:["number"]},helpPageLink:{label:"help_page_link",validators:["relative_url"]},multiOrganisationUnitForms:{label:"multi_organisation_unit_forms",type:"checkbox"},omitIndicatorsZeroNumeratorDataMart:{label:"omit_indicators_zero_numerator_data_mart",type:"checkbox"},keyAnalyticsMaintenanceMode:{label:"put_analytics_in_maintenance_mode",type:"checkbox"},keyHideUnapprovedDataInAnalytics:{label:"hide_unapproved_data_in_analytics",type:"checkbox"},keyAcceptanceRequiredForApproval:{label:"acceptance_required_before_approval",type:"checkbox"},recaptchaSecret:{label:"recaptcha_secret_label",type:"password"},recaptchaSite:{type:"password",label:"recaptcha_site_label"},keyGatherAnalyticalObjectStatisticsInDashboardViews:{label:"gather_analytical_object_statistics_in_dashboard_views",type:"checkbox"},keyCountPassiveDashboardViewsInUsageAnalytics:{label:"count_passive_dashboard_views_in_usage_analytics",type:"checkbox"},keyAnalysisRelativePeriod:{label:"default_analysis_relative_period",type:"dropdown",options:{THIS_MONTH:"THIS_MONTH",LAST_MONTH:"LAST_MONTH",THIS_BIMONTH:"THIS_BIMONTH",LAST_BIMONTH:"LAST_BIMONTH",THIS_QUARTER:"THIS_QUARTER",LAST_QUARTER:"LAST_QUARTER",THIS_SIX_MONTH:"THIS_SIX_MONTH",LAST_SIX_MONTH:"LAST_SIX_MONTH",MONTHS_THIS_YEAR:"MONTHS_THIS_YEAR",QUARTERS_THIS_YEAR:"QUARTERS_THIS_YEAR",THIS_YEAR:"THIS_YEAR",MONTHS_LAST_YEAR:"MONTHS_LAST_YEAR",QUARTERS_LAST_YEAR:"QUARTERS_LAST_YEAR",LAST_YEAR:"LAST_YEAR",LAST_5_YEARS:"LAST_5_YEARS",LAST_12_MONTHS:"LAST_12_MONTHS",LAST_6_MONTHS:"LAST_6_MONTHS",LAST_3_MONTHS:"LAST_3_MONTHS",LAST_6_BIMONTHS:"LAST_6_BIMONTHS",LAST_4_QUARTERS:"LAST_4_QUARTERS",LAST_2_SIXMONTHS:"LAST_2_SIXMONTHS",THIS_FINANCIAL_YEAR:"THIS_FINANCIAL_YEAR",LAST_FINANCIAL_YEAR:"LAST_FINANCIAL_YEAR",LAST_5_FINANCIAL_YEARS:"LAST_5_FINANCIAL_YEARS",THIS_WEEK:"THIS_WEEK",LAST_WEEK:"LAST_WEEK",LAST_4_WEEKS:"LAST_4_WEEKS",LAST_12_WEEKS:"LAST_12_WEEKS",LAST_52_WEEKS:"LAST_52_WEEKS"}},keyHideDailyPeriods:{label:"key_hide_daily_periods",sectionLabel:"hidden_period_types_in_analytics_apps",type:"checkbox"},keyHideWeeklyPeriods:{label:"key_hide_weekly_periods",type:"checkbox"},keyHideMonthlyPeriods:{label:"key_hide_monthly_periods",type:"checkbox"},keyHideBiMonthlyPeriods:{label:"key_hide_bi_monthly_periods",type:"checkbox"},analyticsFinancialYearStart:{label:"analytics_financial_year_start",type:"dropdown",options:{FINANCIAL_YEAR_APRIL:"APRIL",FINANCIAL_YEAR_JULY:"JULY",FINANCIAL_YEAR_OCTOBER:"OCTOBER"}},keyCacheability:{label:"cacheability",type:"dropdown",options:{PUBLIC:"public",PRIVATE:"private"}},keyAnalyticsCacheTtlMode:{label:"key_analytics_cache_ttl_mode",type:"dropdown",options:{PROGRESSIVE:"progressive",FIXED:"fixed"}},keyAnalyticsCacheProgressiveTtlFactor:{label:"key_analytics_cache_progressive_ttl_factor",type:"dropdown",options:{1:"1",2:"2",4:"4",8:"8",16:"16",32:"32",64:"64",128:"128",192:"192",256:"256",320:"320",512:"512",1024:"1024"},hideWhen:{settingsKey:"keyAnalyticsCacheTtlMode",settingsValue:"FIXED"}},keyCacheStrategy:{label:"cache_strategy",type:"dropdown",options:{NO_CACHE:"no_cache",CACHE_15_MINUTES:"cache_for_15_minutes",CACHE_30_MINUTES:"cache_for_30_minutes",CACHE_1_HOUR:"cache_for_one_hour",CACHE_6AM_TOMORROW:"cache_until_6am_tomorrow",CACHE_TWO_WEEKS:"cache_for_two_weeks"}},keyIgnoreAnalyticsApprovalYearThreshold:{label:"max_number_of_years_to_hide_unapproved_data_in_analytics",type:"dropdown",options:{"-1":"never_check_approval",0:"check_approval_for_all_data",1:"current_year_only",2:"last_2_years",3:"last_3_years",4:"last_4_years",5:"last_5_years",6:"last_6_years",7:"last_7_years",8:"last_8_years",9:"last_9_years",10:"last_10_years"}},keySkipDataTypeValidationInAnalyticsTableExport:{label:"skip_data_type_validation_in_analytics_table_export",type:"checkbox"},keyRespectMetaDataStartEndDatesInAnalyticsTableExport:{label:"respect_category_option_start_and_end_date_in_analytics_table_export",type:"checkbox"},keyDatabaseServerCpus:{label:"no_of_database_server_cpus",type:"dropdown",options:{0:"detect_based_on_web_server",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",16:"16",32:"32"}},keySystemNotificationsEmail:{label:"system_notifications_email_address",validators:["email"]},googleAnalyticsUA:{label:"google_analytics_ua_key"},keyBingMapsApiKey:{label:"key_bing_maps_api_key",type:"password"},localizedText:{type:"localizedAppearance",searchLabels:["application_title","application_introduction","application_notification","application_left_footer","application_right_footer"]},applicationTitle:{label:"application_title",appendLocale:!0,multiLine:!0},keyApplicationIntro:{label:"application_introduction",description:"allows_html",appendLocale:!0,multiLine:!0},keyApplicationNotification:{label:"application_notification",description:"allows_html",appendLocale:!0,multiLine:!0},keyApplicationFooter:{label:"application_left_footer",description:"allows_html",appendLocale:!0,multiLine:!0},keyApplicationRightFooter:{label:"application_right_footer",description:"allows_html",appendLocale:!0,multiLine:!0},keyStyle:{label:"style",type:"dropdown",includeEmpty:!1,userSettingsOverride:!0,searchLabels:["style","can_be_overridden_by_user_settings"],source:"styles"},startModule:{label:"start_page",type:"dropdown",source:"startModules"},keyFlag:{label:"flag",type:"dropdown",source:"flags"},keyUiLocale:{label:"ui_locale",type:"dropdown",userSettingsOverride:!0,searchLabels:["style","can_be_overridden_by_user_settings"],source:"uiLocales"},keyDbLocale:{label:"db_locale",type:"dropdown",userSettingsOverride:!0,searchLabels:["style","can_be_overridden_by_user_settings"],source:"dbLocales"},keyAnalysisDisplayProperty:{label:"analysis_display_property",type:"dropdown",userSettingsOverride:!0,searchLabels:["style","can_be_overridden_by_user_settings"],options:{name:"name",shortName:"short_name"}},keyAnalysisDigitGroupSeparator:{label:"analysis_digit_group_separator",type:"dropdown",options:{SPACE:"space",COMMA:"comma",NONE:"none"}},keyRequireAddToView:{label:"require_authority_to_add_to_view_object_lists",type:"checkbox"},keyUseCustomLogoFront:{label:"custom_login_page_logo",type:"staticContent",name:"logo_front"},keyUseCustomLogoBanner:{label:"custom_top_menu_logo",type:"staticContent",name:"logo_banner"},keyDashboardContextMenuItemSwitchViewType:{label:"dashboard_context_menu_item_switch_view_type",type:"checkbox"},keyDashboardContextMenuItemOpenInRelevantApp:{label:"dashboard_context_menu_open_in_relevant_app",type:"checkbox"},keyDashboardContextMenuItemShowInterpretationsAndDetails:{label:"dashboard_context_menu_item_show_interpretations_and_details",type:"checkbox"},keyDashboardContextMenuItemViewFullscreen:{label:"dashboard_context_menu_item_view_full_screen",type:"checkbox"},keyEmailHostName:{label:"host_name"},keyEmailPort:{label:"port",type:"dropdown",options:{587:587,465:465,25:25}},keyEmailUsername:{label:"username"},keyEmailPassword:{label:"password",type:"password"},keyEmailTls:{label:"tls",type:"checkbox"},keyEmailSender:{label:"email_sender",validators:["email"]},emailTestButton:{label:"send_test_email",type:"postButton",uri:"/email/test"},selfRegistrationRole:{label:"self_registration_account_user_role",configuration:!0,type:"dropdown",source:"userRoles",includeEmpty:!0,emptyLabel:"disable_self_registration"},keySelfRegistrationNoRecaptcha:{label:"do_not_require_recaptcha_for_self_registration",type:"checkbox"},selfRegistrationOrgUnit:{label:"self_registration_account_organisation_unit",configuration:!0,type:"dropdown",source:"organisationUnits",includeEmpty:!0,emptyLabel:"disable_self_registration"},keyAccountRecovery:{label:"enable_user_account_recovery",type:"checkbox"},keyLockMultipleFailedLogins:{label:"lock_user_account_temporarily_after_multiple_failed_login_attempts",type:"checkbox"},keyCanGrantOwnUserAuthorityGroups:{label:"allow_users_to_grant_own_user_roles",type:"checkbox"},keyAllowObjectAssignment:{label:"allow_assigning_object_to_related_objects_during_add_or_update",type:"checkbox"},credentialsExpiryAlert:{label:"enable_password_expiry_alerts",type:"checkbox"},credentialsExpires:{label:"user_credentials_expires",type:"dropdown",options:{0:"never",3:"3_months",6:"6_months",12:"12_months"}},minPasswordLength:{label:"min_chars_in_password",type:"dropdown",options:{8:8,10:10,12:12,14:14}},corsWhitelist:{label:"cors_whitelist",configuration:!0,multiLine:!0,hintText:"one_url_per_line",validators:["url_array"]},keyGoogleMapsApiKey:{label:"google_maps_api_key",type:"password"},keyCalendar:{label:"calendar",type:"dropdown",options:{coptic:"coptic",ethiopian:"ethiopian",gregorian:"gregorian",islamic:"islamic",iso8601:"iso8601",julian:"julian",nepali:"nepali",thai:"thai",persian:"persian"}},keyDateFormat:{label:"date_format",type:"dropdown",options:{"yyyy-MM-dd":"yyyy-MM-dd","dd-MM-yyyy":"dd-MM-yyyy"}},keyRemoteInstanceUrl:{label:"remote_server_url",validators:["url"]},keyRemoteInstanceUsername:{label:"remote_server_username"},keyRemoteInstancePassword:{label:"remote_server_password",type:"password"},keyMetadataDataVersioning:{label:"keyVersionEnabled",type:"metadataSettings"},keyVersionEnabled:{label:"keyVersionEnabled",type:"checkbox"},keyStopMetadataSync:{label:"keyStopMetadataSync",type:"checkbox"},createVersionButton:{label:"create_metadata_version",type:"postButton",uri:"/metadata/version/create"},keyDataImportStrictPeriods:{label:"require_periods_to_match_period_type",type:"checkbox"},keyDataImportStrictDataElements:{label:"require_data_elements_to_be_part_of_data_set",type:"checkbox"},keyDataImportStrictCategoryOptionCombos:{label:"require_category_option_combos_to_match",type:"checkbox"},keyDataImportStrictOrganisationUnits:{label:"require_organisation_units_to_match_assignment",type:"checkbox"},keyDataImportStrictAttributeOptionCombos:{label:"require_attribute_option_combos_to_match",type:"checkbox"},keyDataImportRequireCategoryOptionCombo:{label:"require_category_option_combo_to_be_specified",type:"checkbox"},keyDataImportRequireAttributeOptionCombo:{label:"require_attribute_option_combo_to_be_specified",type:"checkbox"},oauth2clients:{type:"oauth2clients",searchLabels:["oauth2_clients","password","refresh_token","authorization_code"]}},L=S.a.create();const x=f.a.createActionsFromNames(["load","setCategory","saveKey","searchSettings","showSnackbarMessage"]);x.saveKey.subscribe((e=>{const[t,a,s]=e.data,n=w[t];Object(T.getInstance)().then((e=>{const i=n.appendLocale&&s;i?((e,t,a,s)=>{const n=`/systemSettings/${t}?value=${a}${s?`&locale=${s}`:""}`;e.Api.getApi().post(n).then((()=>{x.showSnackbarMessage(e.i18n.getTranslation("settings_updated"))})).catch((e=>{console.error("Failed to save localized setting:",e)}))})(e,t,a,s):n.configuration?((e,t,a)=>{e.system.configuration.set(t,a).then((()=>{x.showSnackbarMessage(e.i18n.getTranslation("settings_updated"))})).catch((e=>{console.error("Failed to save configuration:",e)}))})(e,t,a):((e,t,a)=>{e.system.settings.set(t,a).then((()=>{x.showSnackbarMessage(e.i18n.getTranslation("settings_updated"))})).catch((e=>{console.error("Failed to save setting:",e)}))})(e,t,a),i||(L.state[t]=a,L.setState(L.state))}))}));const R=E.Observable.fromPromise(new Promise((e=>{x.load.subscribe((t=>{Object(T.getInstance)().then((a=>{Promise.all([a.system.settings.all(),a.system.configuration.all(!0===t.data)]).then((e=>{const t=Object.keys(e[1]).filter((e=>"systemId"!==e)).map((t=>({key:t,value:e[1][t]}))).reduce(((e,t)=>{let a=t.value;return null===a||"null"===a||void 0===a?a="null":Object.hasOwnProperty.call(a,"id")&&(a=a.id),e[t.key]=a,e}),{});t.corsWhitelist=(e[1].corsWhitelist||[]).filter((e=>e.trim().length>0)).sort().join("\n"),Object.keys(e[0]).forEach((t=>{const a=e[0][t];e[0][t]=null===a||isNaN(a)?a:a.toString()})),L.setState(Object.assign({},e[0],t))}),(e=>{console.error("Failed to load system settings:",e)}));const s=Object.keys(C).filter((e=>!C[e].authority||a.currentUser.authorities.has(C[e].authority))).map((e=>C[e].settings)).reduce(((e,t)=>e.concat(t)),[]).reduce(((e,t)=>w[t]?w[t].searchLabels?e.concat(w[t].searchLabels.filter((e=>a.i18n.isTranslated(e))).map((e=>[a.i18n.getTranslation(e),t]))):e.concat([[a.i18n.getTranslation(w[t].label),t]]):e),[]);e(s)}))}))})));let O;x.searchSettings.distinctUntilChanged().debounceTime(150).map((e=>e.data.trim().split(/\s+/).filter((e=>e.length>0)))).do((e=>{O=e,0===e.length&&x.setCategory("general")})).filter((e=>e.length)).map((e=>{return t=e,R.flatMap((e=>E.Observable.from(e))).filter((e=>t.every((t=>e[0].toLowerCase().includes(t.toLowerCase()))))).map((([,e])=>e)).distinct().reduce(((e,t)=>e.concat(t)),[]).map((e=>(1===t.length&&Object.hasOwnProperty.call(w,t[0])&&e.push(t[0]),e)));var t})).concatAll().subscribe((e=>{x.setCategory({key:"search",settings:e,searchTerms:O})}));var M=x,I=a(297),N=a(517),U=a(1109),F=a(270),P=a.n(F),D=a(350),V=a.n(D);function H(){return(H=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e}).apply(this,arguments)}const j={color:"rgba(0, 0, 0, 0.3)",fontSize:"12px",margin:"16px 0 6px 0"};class q extends r.a.Component{render(){const{errorText:e,errorStyle:t,onChange:a,sectionLabel:s,value:n,...i}=this.props;return r.a.createElement("div",{style:{marginTop:12,marginBottom:12}},s&&r.a.createElement("p",{style:j},s),r.a.createElement(V.a,H({onCheck:a,checked:"true"===n},i)))}}q.defaultProps={value:"false"};var B=q,W=a(1124),K=a.n(W),G=a(1129),z=a.n(G);function Y(){return(Y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e}).apply(this,arguments)}function $(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Q extends r.a.Component{constructor(e){super(e),this.handleChange=this.handleChange.bind(this)}handleChange(e,t,a){this.props.onChange({target:{value:a}})}renderMenuItems(e){return this.props.includeEmpty&&e.unshift({id:"null",displayName:this.props.emptyLabel}),e.map((e=>r.a.createElement(K.a,{key:e.id,value:e.id,primaryText:e.displayName})))}render(){const{onFocus:e,onBlur:t,onChange:a,value:s,disabled:n,menuItems:i,includeEmpty:o,emptyLabel:l,noOptionsLabel:c,isRequired:p,...d}=this.props,h=Array.isArray(i)&&i||i.toArray(),u=h.length>0;return r.a.createElement(z.a,Y({value:u?this.props.value:1,onChange:this.handleChange,disabled:!u||n},d),u?this.renderMenuItems(h):r.a.createElement(K.a,{value:1,primaryText:this.props.noOptionsLabel||"-"}))}}$(Q,"propTypes",{value:_.a.string.isRequired,defaultValue:_.a.oneOfType([_.a.string,_.a.number,_.a.bool]),emptyLabel:_.a.string,includeEmpty:_.a.bool,menuItems:_.a.oneOfType([_.a.array,_.a.object]),noOptionsLabel:_.a.string,onBlur:_.a.func,onChange:_.a.func,onFocus:_.a.func}),$(Q,"defaultProps",{defaultValue:"",includeEmpty:!1,emptyLabel:"",menuItems:[],noOptionsLabel:"",onFocus:void 0,onBlur:void 0,onChange:void 0});var X=Q,J=a(524),Z=a.n(J),ee=a(315),te=a.n(ee),ae=a(1140),se=a.n(ae),ne=a(272),ie=a(381),oe=a.n(ie),re=a(382),le=a.n(re),ce=a(232);const pe={spacing:le.a,fontFamily:"Roboto, sans-serif",palette:{primary1Color:ne.blue500,primary2Color:ne.blue700,primary3Color:ne.blue100,accent1Color:ne.orange500,accent2Color:ne.grey100,accent3Color:ne.orangeA200,textColor:ne.darkBlack,alternateTextColor:ne.white,canvasColor:ne.white,borderColor:ne.grey400,disabledColor:Object(ce.fade)(ne.darkBlack,.3)}},de=oe()(pe);var he=Object.assign({},de,{forms:{minWidth:350,maxWidth:750},formInput:{fontWeight:100}});function ue(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class me extends r.a.Component{constructor(e){super(e),ue(this,"state",{isEnabled:this.props.isEnabled,uploading:!1,progress:void 0,showDialog:!1}),this.onClick=this.onClick.bind(this),this.onPreviewClick=this.onPreviewClick.bind(this),this.onToggle=this.onToggle.bind(this),this.onUpload=this.onUpload.bind(this)}onClick(e){this.fileInput&&!this.state.uploading?this.fileInput.click(e):this.state.uploading&&(this.xhr.abort(),this.setState({uploading:!1,progress:void 0}))}onPreviewClick(){this.setState((e=>({showDialog:!e.showDialog})))}onToggle(e){this.props.onChange({target:{value:e.target.checked}})}onUpload(e){if(0===e.target.files.length)return;this.setState({uploading:!0,progress:void 0});const t=this.context.d2.Api.getApi(),a=new XMLHttpRequest;a.upload.onprogress=e=>{e.lengthComputable?this.setState({progress:e.loaded/e.total*100}):this.setState({progress:void 0})},this.xhr=a;const s=new FormData;s.append("file",e.target.files[0]),t.post(["staticContent",this.props.name].join("/"),s).then((()=>{this.props.onChange({target:{value:!0}}),this.setState({uploading:!1,progress:void 0,isEnabled:!0})})).catch((()=>{this.props.onChange({target:{value:!1}}),this.setState({uploading:!1,progress:void 0,isEnabled:!1})}))}renderUploading(){return r.a.createElement("div",null,r.a.createElement(te.a,{label:l.a.t("Cancel upload"),onClick:this.onClick}),r.a.createElement("div",{style:{position:"absolute",left:0,right:0,zIndex:1}},r.a.createElement(se.a,{mode:this.state.progress?"determinate":"indeterminate",value:this.state.progress})))}renderUpload(){const e={backgroundColor:he.rawTheme.palette.primary1Color,textAlign:"center",overflow:"auto",padding:48},t={maxWidth:"100%",maxHeight:"70vh"},a=`${[this.context.d2.Api.getApi().baseUrl,"staticContent",this.props.name].join("/")}?at=${new Date}`;return this.state.isEnabled?r.a.createElement("div",null,r.a.createElement(te.a,{label:l.a.t("Replace image"),secondary:!0,onClick:this.onClick}),r.a.createElement(te.a,{label:l.a.t("Preview image"),onClick:this.onPreviewClick}),r.a.createElement(Z.a,{open:this.state.showDialog,onRequestClose:this.onPreviewClick,autoDetectWindowHeight:!0,autoScrollBodyContent:!0,bodyStyle:e},r.a.createElement("img",{style:t,src:a,alt:"preview"}))):r.a.createElement(te.a,{label:l.a.t("Upload image"),primary:!0,onClick:this.onClick})}render(){const{onFocus:e,onBlur:t,onChange:a,...s}=this.props;return r.a.createElement("div",{style:{position:"relative",display:"block",whiteSpace:"nowrap"}},r.a.createElement("div",{style:{display:"inline-block",whiteSpace:"nowrap",paddingRight:8,paddingTop:8,paddingBottom:8}},r.a.createElement(V.a,{label:this.props.label,onCheck:this.onToggle,disabled:!this.state.isEnabled,labelStyle:{color:he.rawTheme.palette.textColor},checked:this.props.value})),r.a.createElement("div",{style:{display:"inline-block",position:"absolute",top:2}},this.state.uploading?this.renderUploading():this.renderUpload(),r.a.createElement("input",{type:"file",style:{visibility:"hidden",display:"none"},ref:e=>{this.fileInput=e},onChange:this.onUpload})))}}ue(me,"propTypes",{isEnabled:_.a.bool.isRequired,label:_.a.string.isRequired,name:_.a.oneOf(["logo_front","logo_banner"]).isRequired,value:_.a.bool.isRequired,onBlur:_.a.func,onChange:_.a.func,onFocus:_.a.func}),ue(me,"defaultProps",{onFocus:void 0,onBlur:void 0,onChange:void 0});var ye=me,ge=a(351),_e=a.n(ge);var be=e=>{const{errorStyle:t,errorText:a,...s}=e;return r.a.createElement(_e.a,s)},ve=a(314),Se=a.n(ve);function ke(){return(ke=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e}).apply(this,arguments)}function Te(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const fe={fontSize:"12px",color:"rgba(0, 0, 0, 0.3)",margin:"-4px 0 0"};class Ee extends r.a.Component{constructor(e){super(e),Te(this,"state",{value:this.props.value}),this.onChange=this.onChange.bind(this)}UNSAFE_componentWillReceiveProps(e){this.setState({value:e.value})}onChange(e){this.setState({value:e.target.value})}render(){const{changeEvent:e,isRequired:t,defaultValue:a,helpText:s,...n}=this.props,i={lineHeight:this.props.multiLine?"48px":"12px",marginTop:this.props.multiLine?-16:0};return r.a.createElement("div",null,r.a.createElement(Se.a,ke({errorStyle:i},n,{value:this.state.value,onChange:this.onChange})),s&&r.a.createElement("p",{style:fe},s))}}Te(Ee,"propTypes",{helpText:_.a.node,multiLine:_.a.bool,value:_.a.string}),Te(Ee,"defaultProps",{value:"",multiLine:!1,helpText:""});var Ae=Ee,Ce=a(525),we=a.n(Ce);function Le(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const xe={inset:{padding:"0 16px 8px",borderRadius:2,boxShadow:"0px 0px 5px rgba(0,0,0,0.15), 0px 2px 3px rgba(0,0,0,0.15)",margin:"8px -12px 4px"},field:{width:"100%"},loaderWrap:{textAlign:"center",padding:12},error:{color:"red",padding:12},clickableHelpText:{color:"#3162C5",textDecoration:"underline",cursor:"pointer"}},Re="@@__SYSTEM_DEFAULT__@@",Oe=["applicationTitle","keyApplicationIntro","keyApplicationNotification","keyApplicationFooter","keyApplicationRightFooter"];class Me extends r.a.Component{static getLocaleName(e){return k.state&&k.getState().uiLocales.filter((t=>t.id===e)).map((e=>e.displayName)).pop()||""}constructor(e,t){super(e,t),Le(this,"switchToDefaultLocale",(()=>{this.handleChange({target:{value:Re}})})),Le(this,"createFieldHelpTextProps",(e=>{const t=L.state[e],{locale:a}=this.state;return a===Re?null:t?{helpText:`${this.getTranslation("default_value")}: ${t}`}:{disabled:!0,helpText:r.a.createElement("span",{style:xe.clickableHelpText,onClick:this.switchToDefaultLocale},this.getTranslation("set_main_value_first"))}})),this.state={locale:L.state&&L.state.keyUiLocale,localeName:L.state&&Me.getLocaleName(L.state.keyUiLocale),settings:null,error:!1},this.handleChange=this.handleChange.bind(this),this.saveSettingsKey=this.saveSettingsKey.bind(this),this.getTranslation=t.d2.i18n.getTranslation.bind(t.d2.i18n)}componentDidMount(){this.getAppearanceSettings(),this.settingsStoreSubscription=L.subscribe((()=>{this.setState({locale:L.state.keyUiLocale,localeName:Me.getLocaleName(L.state.keyUiLocale)})}))}componentWillUnmount(){this.settingsStoreSubscription&&this.settingsStoreSubscription.unsubscribe()}getAppearanceSettings(e){const t=e||this.state.locale;(t===Re?Promise.resolve(Oe.map((e=>L.state[e]))):this.fetchLocalizedAppearanceSettings(t)).then((e=>{const t=Oe.reduce(((t,a,s)=>(t[a]=e[s],t)),{});this.setState({settings:t,error:!1})})).catch((()=>{this.setState({error:!0,settings:null})}))}fetchLocalizedAppearanceSettings(e){const t=this.context.d2.Api.getApi();return Promise.all(Oe.map((a=>t.get(`systemSettings/${a}`,{locale:e}).then((e=>e[a])))))}handleChange(e){const t=e.target.value;this.setState({locale:t,localeName:Me.getLocaleName(t),settings:null}),this.getAppearanceSettings(t)}saveSettingsKey(e,t){this.setState({settings:{...this.state.settings,[e]:t}});const a=this.state.locale===Re?null:this.state.locale;M.saveKey(e,t,a)}renderLocalizedAppearanceFields(){if(!this.state.settings&&!this.state.error)return r.a.createElement("div",{style:xe.loaderWrap},r.a.createElement(we.a,null));if(this.state.error)return r.a.createElement("div",{style:xe.error},this.getTranslation("could_not_fetch_localized_settings"));const e=Oe.map((e=>({name:e,value:this.state.settings[e]||"",component:Ae,props:{floatingLabelText:`${this.getTranslation(w[e].label)} - ${this.state.localeName||this.getTranslation("system_default")}`,changeEvent:"onBlur",style:xe.field,multiLine:!0,...this.createFieldHelpTextProps(e)}})));return r.a.createElement(I.a,{fields:e,onUpdateField:this.saveSettingsKey})}render(){const e={id:Re,displayName:this.getTranslation("system_default")},t=k.getState(),a=[e,...t&&t.uiLocales||[]];return r.a.createElement("div",null,r.a.createElement("div",{style:xe.inset},r.a.createElement(X,{menuItems:a,value:this.state.locale||"",floatingLabelText:l.a.t("Select language"),onChange:this.handleChange}),this.state.locale&&this.renderLocalizedAppearanceFields()))}}Me.contextTypes={d2:_.a.object.isRequired};var Ie=Me,Ne=a(1143),Ue=a(1174);a(1178);class Fe extends r.a.Component{constructor(e,t){super(e,t),this.state={metadataVersions:[],selectedTransactionType:"BEST_EFFORT",masterVersionName:null,lastFailedTime:null,hqInstanceUrl:null,isVersioningEnabled:!1,remoteVersionName:null,isLocalInstance:!1,hasVersions:!1,isTaskRunning:!1},this.d2=t.d2,this.getTranslation=t.d2.i18n.getTranslation.bind(t.d2.i18n),this.onSelectTransactionType=this.onSelectTransactionType.bind(this),this.syncVersions=this.syncVersions.bind(this),this.syncSettings=this.syncSettings.bind(this),this.createVersion=this.createVersion.bind(this),this.onToggleVersioning=this.onToggleVersioning.bind(this),this.onToggleStopSync=this.onToggleStopSync.bind(this),this.saveSettingsKey="keyVersionEnabled",this.stopMetadataSyncKey="keyStopMetadataSync",this.createVersionKey="createVersionButton"}componentDidMount(){this.subscriptions=[],this.subscriptions.push(L.subscribe((e=>{this.setState({isVersioningEnabled:"true"===e[this.saveSettingsKey]},(()=>{this.syncVersions(),this.syncVersions().then(this.syncSettings)}))})))}componentWillUnmount(){this.subscriptions.forEach((e=>e.unsubscribe()))}onSelectTransactionType(e,t){this.setState({selectedTransactionType:t})}onToggleVersioning(e,t){M.saveKey(this.saveSettingsKey,t?"true":"false")}onToggleStopSync(e,t){M.saveKey(this.stopMetadataSyncKey,t?"true":"false")}createVersion(){const e=w[this.createVersionKey];this.setState({isTaskRunning:!0}),this.d2.Api.getApi().post(`${e.uri}?type=${this.state.selectedTransactionType}`).then((()=>(this.setState({isTaskRunning:!1}),M.load(!0),M.showSnackbarMessage(this.getTranslation("version_created")),Promise.resolve()))).then(this.sync).catch((()=>(this.setState({isTaskRunning:!1}),M.showSnackbarMessage(this.getTranslation("version_not_created")),Promise.resolve())))}syncSettings(){this.d2.Api.getApi().get("/systemSettings").then((e=>(this.setState({lastFailedTime:e.keyMetadataLastFailedTime?e.keyMetadataLastFailedTime:null,isVersioningEnabled:e.keyVersionEnabled,hqInstanceUrl:e.keyRemoteInstanceUrl,remoteVersionName:e.keyRemoteMetadataVersion,lastFailedVersion:e.keyMetadataFailedVersion?e.keyMetadataFailedVersion:null,isSchedulerEnabled:void 0!==e.keySchedTasks}),void 0!==this.state.hqInstanceUrl&&0!==this.state.hqInstanceUrl.length?this.setState({isLocalInstance:!0,masterVersionName:this.state.remoteVersionName,isLastSyncValid:null!=this.state.lastFailedTime}):this.setState({isLocalInstance:!1,masterVersionName:void 0!==this.state.metadataVersions&&0!==this.state.metadataVersions.length?this.state.metadataVersions[0].name:null}),Promise.resolve()))).catch((()=>(M.showSnackbarMessage(this.getTranslation("error_fetching_settings")),Promise.resolve())))}syncVersions(){return!0===this.state.isVersioningEnabled?this.d2.Api.getApi().get("/metadata/versions").then((e=>{const t=e.metadataversions.sort(((e,t)=>e.created<t.created?1:e.created>t.created?-1:0));return t.forEach((e=>{e.importdate=e.importdate?new Date(e.importdate).toLocaleString():"NA"})),this.setState({metadataVersions:t,hasVersions:void 0!==t&&0!==t.length}),Promise.resolve()})).catch((()=>(this.setState({hasVersions:!1}),Promise.resolve()))):Promise.resolve()}renderVersionList(){const e={inlineRight:{display:"inline-block",float:"right"},visible:{display:"block",paddingTop:"2rem"},hidden:{display:"none"},inlineProgressIcon:{display:"inline-block",top:"-7px",float:"left"}},t=(e,t=(e=>e))=>({rowIndex:a,...s})=>r.a.createElement(Ne.Cell,s,t(this.state.metadataVersions[a][e]));return r.a.createElement("div",null,r.a.createElement("h3",null,this.getTranslation("create_metadata_version")),r.a.createElement("div",null,r.a.createElement("div",{style:{display:"inline-block"}},r.a.createElement(Ue.RadioButtonGroup,{name:"version_types",onChange:this.onSelectTransactionType,defaultSelected:"BEST_EFFORT",style:{display:"flex"}},r.a.createElement(Ue.RadioButton,{value:"BEST_EFFORT",label:this.getTranslation("version_type_best_effort"),disabled:this.state.isTaskRunning}),r.a.createElement(Ue.RadioButton,{value:"ATOMIC",label:this.getTranslation("version_type_atomic"),disabled:this.state.isTaskRunning}))),r.a.createElement("div",{style:e.inlineRight},this.state.isTaskRunning&&r.a.createElement(we.a,{style:e.inlineProgressIcon,size:.5}),r.a.createElement(_e.a,{label:this.getTranslation("create_metadata_version"),onClick:this.createVersion,disabled:this.state.isTaskRunning}))),r.a.createElement("div",{style:this.state.hasVersions?e.visible:e.hidden},r.a.createElement("div",{style:{display:"inline-block",float:"left"}},r.a.createElement("span",{style:{fontSize:"1.17em",fontWeight:"bold",marginRight:8}},this.getTranslation("master_version"),":"),this.state.masterVersionName||this.getTranslation("none")),r.a.createElement("div",{style:this.state.isLocalInstance?e.inlineRight:e.hidden},r.a.createElement("div",{style:this.state.isLastSyncValid?e.inlineRight:e.hidden},r.a.createElement("span",{style:{fontStyle:"italic"}},this.getTranslation("last_sync_attempt"),":"),r.a.createElement("span",null,this.state.lastFailedVersion),r.a.createElement("span",null," ","|"," ",r.a.createElement("span",{style:{color:"red"}},this.getTranslation("failed")),"|"," ",new Date(this.state.lastFailedTime).toLocaleString())))),r.a.createElement("div",{style:this.state.isLocalInstance?e.visible:e.hidden},r.a.createElement(Ne.Table,{rowHeight:50,rowsCount:this.state.metadataVersions.length,width:670,maxHeight:300,headerHeight:50},r.a.createElement(Ne.Column,{header:r.a.createElement(Ne.Cell,null,"Version"),cell:t("name"),width:135}),r.a.createElement(Ne.Column,{header:r.a.createElement(Ne.Cell,null,"When"),cell:t("created",(e=>new Date(e).toLocaleString())),width:205}),r.a.createElement(Ne.Column,{header:r.a.createElement(Ne.Cell,null,"Type"),cell:t("type"),width:145}),r.a.createElement(Ne.Column,{header:r.a.createElement(Ne.Cell,null,"Last Sync"),cell:t("importdate"),width:185}))),r.a.createElement("div",{style:this.state.isLocalInstance?e.hidden:e.visible},r.a.createElement(Ne.Table,{rowHeight:50,rowsCount:this.state.metadataVersions.length,width:670,maxHeight:300,headerHeight:50},r.a.createElement(Ne.Column,{header:r.a.createElement(Ne.Cell,null,"Version"),cell:t("name"),width:190}),r.a.createElement(Ne.Column,{header:r.a.createElement(Ne.Cell,null,"When"),cell:t("created"),width:280}),r.a.createElement(Ne.Column,{header:r.a.createElement(Ne.Cell,null,"Type"),cell:t("type"),width:200}))),r.a.createElement("div",{style:this.state.hasVersions?e.hidden:e.visible},r.a.createElement("h4",null,this.getTranslation("no_versions_exist"))))}render(){const e="en"===this.state.locale?"":this.state.locale,t=[{name:"keyVersionEnabled",value:L.state&&L.state[this.saveSettingsKey+e]||"",component:B,props:{label:this.getTranslation("keyVersionEnabled"),checked:"true"===(L.state&&L.state[this.saveSettingsKey]),onCheck:this.onToggleVersioning,disabled:this.state.isTaskRunning}},{name:"keyStopMetadataSync",value:L.state&&L.state[this.stopMetadataSyncKey+e]||"",component:B,props:{label:this.getTranslation("keyStopMetadataSync"),checked:"true"===(L.state&&L.state[this.stopMetadataSyncKey]),onCheck:this.onToggleStopSync}}];return r.a.createElement("div",{style:{paddingTop:"2rem"}},r.a.createElement("h2",null,this.getTranslation("metadata_versioning")),r.a.createElement(I.a,{fields:t,onUpdateField:M.saveKey}),!0===this.state.isVersioningEnabled?this.renderVersionList():null)}}Fe.contextTypes={d2:_.a.object.isRequired};var Pe=Fe,De=a(1179),Ve=a(1180),He=a.n(Ve),je=a(271),qe=a.n(je);function Be(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class We extends r.a.Component{constructor(e){super(e),Be(this,"state",{values:this.props.items.reduce(((e,t)=>(t.value&&e.push(t.name),e)),[])}),this.onToggle=this.onToggle.bind(this)}onToggle(e,t,a){this.setState((t=>(a?-1===t.values.indexOf(e)&&t.values.push(e):-1!==t.values.indexOf(e)&&t.values.splice(t.values.indexOf(e),1),t)),(()=>{this.props.onChange({target:{value:this.state.values}})}))}render(){const e=Object.assign({},this.context.muiTheme.forms,this.props.style);return r.a.createElement("div",null,r.a.createElement("div",{style:{marginTop:16,marginBottom:8}},this.props.label),this.props.items.map((t=>{const a=this.onToggle.bind(null,t.name);return r.a.createElement(V.a,{key:t.name,name:t.name,value:"true",defaultChecked:!0===t.value,label:t.text,onCheck:a,style:e,labelPosition:"right"})})))}}Be(We,"propTypes",{label:_.a.string.isRequired,onChange:_.a.func.isRequired,items:_.a.arrayOf(_.a.shape({name:_.a.string.isRequired,text:_.a.string.isRequired,value:_.a.bool})),style:_.a.object}),Be(We,"defaultProps",{items:[],style:{}}),We.contextTypes={muiTheme:_.a.object};var Ke=We,Ge=S.a.create();const ze=f.a.createActionsFromNames(["load","delete"]);ze.load.subscribe((()=>{Object(T.getInstance)().then((e=>{e.models.oAuth2Client.list({paging:!1,fields:":all",order:"displayName"}).then((t=>{const a=e.i18n.getTranslation("yes"),s=e.i18n.getTranslation("no");Ge.setState(t.toArray().map((e=>Object.assign(e,{password:-1!==e.grantTypes.indexOf("password")?a:s,refresh_token:-1!==e.grantTypes.indexOf("refresh_token")?a:s,authorization_code:-1!==e.grantTypes.indexOf("authorization_code")?a:s}))))}))}))})),ze.delete.subscribe((e=>{e.data.delete().then((()=>{ze.load(),Object(T.getInstance)().then((e=>{M.showSnackbarMessage(e.i18n.getTranslation("oauth2_client_deleted"))}))})).catch((e=>{console.error("Error when deleting OAuth2 client:",e),Object(T.getInstance)().then((e=>{M.showSnackbarMessage(e.i18n.getTranslation("failed_to_save_oauth2_client"))}))}))}));var Ye=ze;const $e={wrapper:{position:"relative",marginTop:24},fab:{position:"absolute",top:-28,right:0},loadingMask:{position:"fixed",left:256,top:"3rem",right:0,bottom:0,zIndex:1e3,backgroundColor:"rgba(243,243,243,0.4)"},empty:{padding:"24px 0"}};class Qe extends r.a.Component{constructor(e){var t,a,s;super(e),s={showForm:!1,isEmpty:!0,saving:!1},(a="state")in(t=this)?Object.defineProperty(t,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[a]=s,this.formUpdateAction=this.formUpdateAction.bind(this),this.editAction=this.editAction.bind(this),this.saveAction=this.saveAction.bind(this),this.deleteAction=this.deleteAction.bind(this),this.cancelAction=this.cancelAction.bind(this),this.newAction=this.newAction.bind(this)}componentDidMount(){this.subscriptions=[],this.subscriptions.push(Ge.subscribe((()=>{this.setState({isEmpty:0===Ge.state.length})}))),this.subscriptions.push(Ye.delete.subscribe((()=>{this.setState({saving:!1})}))),Ye.load()}componentWillUnmount(){this.subscriptions.forEach((e=>{e.unsubscribe()}))}cancelAction(){this.clientModel=void 0,Ye.load(),this.setState({showForm:!1})}newAction(){this.clientModel=this.context.d2.models.oAuth2Client.create(),this.clientModel.secret=function(){const e="0123456789abcdef";let t="";for(let a=0;a<32;a++)t+=e.charAt(Math.random()*e.length),8!==a&&12!==a&&16!==a&&20!==a||(t+="-");return t}(),this.setState({showForm:!0})}editAction(e){this.clientModel=e,this.setState({showForm:!0})}deleteAction(e){this.setState({showForm:!1,saving:!0}),Ye.delete(e.id?e:this.clientModel),this.clientModel=void 0}saveAction(){this.clientModel.name=this.clientModel.name||"",this.clientModel.cid=this.clientModel.cid||"",this.setState({saving:!0}),this.clientModel.save().then((e=>{if("OK"!==e.status)throw new Error(e);M.showSnackbarMessage(l.a.t("OAuth2 client saved")),Ye.load(),this.setState({showForm:!1,saving:!1})})).catch((()=>{M.showSnackbarMessage(l.a.t("Failed to save OAuth2 client")),this.setState({saving:!1})}))}formUpdateAction(e,t){let a=t;"redirectUris"===e&&(a=t.split("\n").filter((e=>e.trim().length>0))),this.clientModel[e]=a,this.forceUpdate()}renderForm(){const e=this.context.d2,t=he.forms;t.width="100%";const a=(this.clientModel&&this.clientModel.grantTypes||[]).reduce(((e,t)=>(e[t]=!0,e)),{}),s={dialog:{paddingLeft:128},dialogContent:{maxWidth:400,minWidth:400},dialogBody:{overflowY:"auto"},button:{marginLeft:16},buttonRight:{float:"right"}};const n=[{name:"name",value:this.clientModel.name,component:Ae,props:{floatingLabelText:l.a.t("Name"),style:t,changeEvent:"onBlur"},validators:[{validator:N.a,message:l.a.t("Required")}]},{name:"cid",value:this.clientModel.cid,component:Ae,props:{floatingLabelText:l.a.t("Client ID"),style:t,changeEvent:"onBlur"},validators:[{validator:N.a,message:l.a.t("Required")},{validator:e=>e.toString().trim().length>0,message:l.a.t("Required")}],asyncValidators:[function(t){return new Promise(((a,s)=>{e.models.oAuth2Clients.list({paging:!1,filter:[`cid:eq:${t}`]}).then((e=>{0===e.size?a():s(l.a.t("This client ID is already taken"))}))}))}]},{name:"secret",value:this.clientModel&&this.clientModel.secret,component:Ae,props:{floatingLabelText:l.a.t("Client Secret"),disabled:!0,style:t}},{name:"grantTypes",component:Ke,style:t,props:{label:l.a.t("Grant Types"),items:[{name:"password",text:l.a.t("Password"),value:a.password},{name:"refresh_token",text:l.a.t("Refresh token"),value:a.refresh_token},{name:"authorization_code",text:l.a.t("Authorization code"),value:a.authorization_code}]}},{name:"redirectUris",value:(this.clientModel.redirectUris||[]).join("\n"),component:Ae,props:{hintText:l.a.t("One URL per line"),floatingLabelText:l.a.t("Redirect URIs"),multiLine:!0,style:t,changeEvent:"onBlur"},validators:[{validator:N.b,message:l.a.t("This field should contain a list of URLs")}]}],i=void 0===this.clientModel.id?l.a.t("Create new OAuth2 Client"):l.a.t("Edit OAuth2 Client");return r.a.createElement(Z.a,{open:!0,modal:!0,style:s.dialog,contentStyle:s.dialogContent,bodyStyle:s.dialogBody},r.a.createElement("h2",null,i),r.a.createElement(I.a,{fields:n,onUpdateField:this.formUpdateAction}),r.a.createElement("div",{style:{marginTop:"1rem"}},r.a.createElement(_e.a,{onClick:this.saveAction,primary:!0,label:l.a.t("Save")}),void 0!==this.clientModel.id?r.a.createElement(te.a,{onClick:this.deleteAction,primary:!0,style:s.button,label:l.a.t("Delete")}):void 0,r.a.createElement(te.a,{onClick:this.cancelAction,style:s.buttonRight,label:l.a.t("Cancel")})))}renderList(){return r.a.createElement(i.n,null,r.a.createElement(i.r,null,r.a.createElement(i.t,null,r.a.createElement(i.q,null,l.a.t("Name")),r.a.createElement(i.q,null,l.a.t("Password")),r.a.createElement(i.q,null,l.a.t("Refresh token")),r.a.createElement(i.q,null,l.a.t("Authorization code")),r.a.createElement(i.q,null))),r.a.createElement(i.o,null,Ge.state.map((e=>r.a.createElement(i.s,{key:e.authorization_code},r.a.createElement(i.p,null,e.name),r.a.createElement(i.p,null,e.password),r.a.createElement(i.p,null,e.refresh_token),r.a.createElement(i.p,null,e.authorization_code),r.a.createElement(i.p,null,r.a.createElement(i.c,{small:!0,primary:!0,onClick:this.editAction},l.a.t("Edit")),r.a.createElement(i.c,{small:!0,destructive:!0,onClick:this.deleteAction},l.a.t("Delete"))))))))}render(){return r.a.createElement("div",{style:$e.wrapper},r.a.createElement("div",{style:$e.fab},r.a.createElement(He.a,{onClick:this.newAction},r.a.createElement(qe.a,{className:"material-icons"},"add"))),this.state.saving&&r.a.createElement("div",{style:$e.loadingMask},r.a.createElement(De.a,null)),this.state.isEmpty?r.a.createElement("div",{style:$e.empty},l.a.t("There are currently no OAuth2 clients registered")):this.renderList(),this.state.showForm&&this.renderForm())}}var Xe=Qe;const Je={header:{fontSize:24,fontWeight:300,color:he.rawTheme.palette.textColor,padding:"24px 0 12px 16px"},card:{marginTop:8,marginRight:"1rem",padding:"0 1rem"},cardTitle:{background:he.rawTheme.palette.primary2Color,height:62},cardTitleText:{fontSize:28,fontWeight:100,color:he.rawTheme.palette.alternateTextColor},noHits:{padding:"1rem",marginTop:"1rem",fontWeight:300},userSettingsOverride:{color:he.rawTheme.palette.primary1Color,position:"absolute",right:0,top:24},menuIcon:{color:"#757575"},menuLabel:{position:"relative",top:-6,marginLeft:16}};function Ze(e,t,a){return class extends t{render(){const s=Object.assign({},Je.userSettingsOverride);t===B&&(s.top=-8);const n=void 0!==a?`${e.i18n.getTranslation("will_be_overridden_by_current_user_setting")}: ${a}`:e.i18n.getTranslation("can_be_overridden_by_user_settings");return r.a.createElement("div",{style:{marginRight:48}},super.render(),r.a.createElement("div",{style:s},r.a.createElement(P.a,{iconClassName:"material-icons",tooltip:n,tooltipPosition:"bottom-left",iconStyle:{color:he.rawTheme.palette.primary1Color},tooltipStyles:{fontSize:".75rem",marginRight:32,marginTop:-32}},"info_outline")))}}}function et(e){if(!e||!e.hideWhen)return{};const{settingsKey:t,settingsValue:a}=e.hideWhen;return a===L.state[t]?{display:"none"}:{}}class tt extends r.a.Component{componentDidMount(){this.subscriptions=[],this.subscriptions.push(L.subscribe((()=>this.forceUpdate())))}shouldComponentUpdate(e){return e.currentSettings.join(",")!==this.props.currentSettings.join(",")}componentWillUnmount(){Array.isArray(this.subscriptions)&&this.subscriptions.forEach((e=>e.unsubscribe()))}fieldForMapping({mapping:e,fieldBase:t,key:a,d2:s}){switch(e.type){case"textfield":case void 0:return Object.assign({},t,{props:Object.assign({},t.props,{changeEvent:"onBlur",multiLine:!!e.multiLine})});case"password":return Object.assign({},t,{props:Object.assign({},t.props,{type:"password",changeEvent:"onBlur",autoComplete:"new-password"})});case"dropdown":return e.includeEmpty&&""===t.value&&(t.value="null"),Object.assign({},t,{component:X,props:Object.assign({},t.props,{menuItems:e.source?k.state&&k.state[e.source]||[]:Object.keys(e.options).map((t=>({id:t,displayName:isNaN(e.options[t])?s.i18n.getTranslation(e.options[t]):e.options[t]}))),includeEmpty:!!e.includeEmpty,emptyLabel:e.includeEmpty&&e.emptyLabel&&s.i18n.getTranslation(e.emptyLabel)||void 0,noOptionsLabel:s.i18n.getTranslation("no_options")})});case"checkbox":return Object.assign({},t,{component:B,props:{label:t.props.floatingLabelText,sectionLabel:e.sectionLabel&&s.i18n.getTranslation(e.sectionLabel)||void 0,style:t.props.style,onCheck:(e,t)=>{M.saveKey(a,t?"true":"false")}}});case"staticContent":return Object.assign({},t,{component:ye,props:{label:t.props.floatingLabelText,name:e.name,isEnabled:L.state&&Object.hasOwnProperty.call(L.state,a),value:"true"===t.value||!0===t.value}});case"oauth2clients":return Object.assign({},t,{component:Xe});case"postButton":return Object.assign({},t,{component:be,props:{label:t.props.floatingLabelText,onClick:()=>{s.Api.getApi().post(e.uri).then((e=>{M.load(!0),M.showSnackbarMessage(e.message)})).catch((e=>{M.showSnackbarMessage(e.message)}))},style:{minWidth:"initial",maxWidth:"initial",marginTop:"1em"}}});case"localizedAppearance":return Object.assign({},t,{component:Ie});case"metadataSettings":return Object.assign({},t,{component:Pe});default:return console.warn(`Unknown control type "${e.type}" encountered for field "${a}"`),{}}}renderFields(e){const t=this.context.d2;if(0===e.length)return r.a.createElement("div",{style:Je.noHits},t.i18n.getTranslation("no_settings_matched_the_search_term"));const a=e.map((e=>{const a=w[e],s=[];a.validators&&a.validators.forEach((e=>{N.c.has(e)&&s.push({validator:N.c.get(e),message:t.i18n.getTranslation(N.c.get(e).message)})}));const n={name:e,value:L.state&&L.state[e]||"",component:Ae,props:{floatingLabelText:t.i18n.getTranslation(a.label),style:{width:"100%",...et(a)},hintText:a.hintText&&t.i18n.getTranslation(a.hintText)},validators:s};return this.fieldForMapping({mapping:a,fieldBase:n,key:e,d2:t})})).filter((e=>!!e.name)).map((e=>{const a=w[e.name],s=k.getState();if(a.userSettingsOverride){const n=s&&s.userSettingsNoFallback||{},i=n&&null!==n[e.name]?n[e.name]:"";let o=e.component;if(""===i)o=Ze(t,o);else if(a.source){const e=(s&&s[a.source]||[]).filter((e=>e.id===i)).map((e=>e.displayName)).pop();o=Ze(t,o,e)}else o=Ze(t,o,t.i18n.getTranslation(i));return Object.assign(e,{component:o})}return e}));return r.a.createElement(U.Card,{style:Je.card,key:this.props.category},r.a.createElement(U.CardText,null,r.a.createElement(I.a,{fields:a,onUpdateField:M.saveKey})))}render(){return r.a.createElement("div",{className:"content-area"},r.a.createElement("div",{style:Je.header},C[this.props.category]?C[this.props.category].pageLabel:l.a.t("Search results")),this.renderFields(this.props.currentSettings))}}tt.contextTypes={d2:_.a.object.isRequired};var at=tt;function st(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class nt extends r.a.Component{constructor(e,t){super(e,t),st(this,"closeSnackbar",(()=>{this.setState({showSnackbar:!1})})),st(this,"doSearch",(e=>{this.setState({searchText:e}),M.searchSettings(e)})),this.state={category:A[0],currentSettings:C[A[0]].settings,snackbarMessage:"",showSnackbar:!1,formValidator:void 0},this.sidebarRef=r.a.createRef()}getChildContext(){return{d2:this.props.d2,muiTheme:he}}componentDidMount(){M.load(),this.subscriptions=[],this.subscriptions.push(k.subscribe((()=>{this.forceUpdate()}))),this.subscriptions.push(M.setCategory.subscribe((e=>{const t=e.data.key||e.data||A[0],a=e.data.settings||[],s="search"===t?a:C[t].settings;"search"!==t&&this.sidebarRef.current.clearSearchBox();const n=`/${t}`,i="search"===t?`?${encodeURIComponent(e.data.searchTerms.join(" "))}`:"";n===this.history.location.pathname&&i===this.history.location.search||this.history.push({pathname:n,search:i}),this.setState({category:t,currentSettings:s,searchText:"search"===t?this.state.searchText:""})}))),this.subscriptions.push(M.showSnackbarMessage.subscribe((e=>{const t=e.data;this.setState({snackbarMessage:t,showSnackbar:!!t})})));const e=e=>{const t=e.pathname.substr(1);if("/search"===e.pathname){const t=decodeURIComponent(e.search.substr(1));this.doSearch(t)}else Object.keys(C).includes(t)?M.setCategory(t):(this.history.replace(`/${A[0]}`),M.setCategory(A[0]))};this.history=d()(),this.unlisten=this.history.listen(((t,a)=>{"POP"===a&&e(t)})),e(this.history.location)}componentWillUnmount(){this.subscriptions.forEach((e=>{e.unsubscribe()})),"function"===typeof this.unlisten&&this.unlisten()}render(){const e=Object.keys(C).map((e=>({key:e,label:this.props.d2.i18n.getTranslation(C[e].label),icon:C[e].icon})));return r.a.createElement(y.a,{muiTheme:he},r.a.createElement("div",null,r.a.createElement(u.a,{message:this.state.snackbarMessage||"",autoHideDuration:1250,open:this.state.showSnackbar,onRequestClose:this.closeSnackbar}),r.a.createElement("div",{className:v.a.contentWrap},r.a.createElement(c.a,{sections:e,onChangeSection:M.setCategory,currentSection:this.state.category,showSearchField:!0,searchFieldLabel:l.a.t("Search settings"),ref:this.sidebarRef,onChangeSearchText:this.doSearch,searchText:this.state.searchText}),r.a.createElement("form",{autoComplete:"off",className:v.a.contentArea},r.a.createElement(at,{category:this.state.category,currentSettings:this.state.currentSettings})))))}}nt.contextTypes={muiTheme:_.a.object},nt.childContextTypes={d2:_.a.object,muiTheme:_.a.object};var it=nt,ot=(a(1182),a(1183));l.a.addResources("en","default",ot);var rt=l.a;const lt={indicatorGroups:{resource:"indicatorGroups",params:{paging:!1,fields:"id,displayName",order:"displayName:asc"}},dataElementGroups:{resource:"dataElementGroups",params:{paging:!1,fields:"id,displayName",order:"displayName:asc"}},userGroups:{resource:"userGroups",params:{paging:!1,fields:"id,displayName",order:"displayName:asc"}},organisationUnitLevels:{resource:"organisationUnitLevels",params:{paging:!1,fields:"id,level,displayName",order:"level:asc"}},userRoles:{resource:"userRoles",params:{paging:!1,fields:"id,displayName",order:"displayName:asc"}},organisationUnits:{resource:"organisationUnits",params:{paging:!1,fields:"id,displayName",filter:["level:in:[1,2]"]}},apps:{resource:"action::menu/getModules"},flags:{resource:"system/flags"},styles:{resource:"system/styles"},uiLocales:{resource:"locales/ui"},dbLocales:{resource:"locales/db"},userSettings:{resource:"userSettings"}};t.default=()=>{const{d2:e}=Object(n.a)(),{loading:t,error:a,data:o}=Object(s.d)(lt);if(a)return r.a.createElement(i.d,null,r.a.createElement("p",null,rt.t("Failed to load: {{error}}",{error:a.message,nsSeparator:null})));if(!e||t)return r.a.createElement(i.d,null,r.a.createElement(i.e,null));const{indicatorGroups:l,dataElementGroups:c,userGroups:p,organisationUnitLevels:d,userRoles:h,organisationUnits:u,userSettings:m}=o,y=(o.apps.modules||[]).map((e=>({id:"../"===e.defaultAction.substr(0,3)?e.name:`app:${e.name}`,displayName:e.displayName||e.name}))),g=(o.flags||[]).map((e=>({id:e.key,displayName:e.name})));g.unshift({id:"dhis2",displayName:rt.t("No flag")});const _=(o.styles||[]).map((e=>({id:e.path,displayName:e.name}))),b=(o.uiLocales||[]).map((e=>({id:e.locale,displayName:e.name}))),v=(o.dbLocales||[]).map((e=>({id:e.locale,displayName:e.name})));return k.setState({indicatorGroups:l.indicatorGroups,dataElementGroups:c.dataElementGroups,userGroups:p.userGroups,organisationUnitLevels:d.organisationUnitLevels,userRoles:h.userRoles,organisationUnits:u.organisationUnits,startModules:y,flags:g,styles:_,uiLocales:b,dbLocales:v,userSettingsNoFallback:m}),r.a.createElement(it,{d2:e})}},669:function(e,t,a){e.exports={contentWrap:"App_contentWrap__LkWn-",contentArea:"App_contentArea__4AZNb"}}}]);
//# sourceMappingURL=app.4ba73f59.chunk.js.map